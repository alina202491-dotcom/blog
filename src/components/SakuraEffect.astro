<!-- 
  This is a refined version of the SakuraEffect component.
  - Petal shape is now more realistic and standard.
  - Removed all background dust particles.
  - Adjusted petal size to 4x the original scale.
-->
<canvas id="sakura-canvas"></canvas>

<style>
  #sakura-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Allows clicks to pass through the canvas */
    z-index: 9999;
  }
</style>

<script>
  const canvas = document.getElementById('sakura-canvas') as HTMLCanvasElement;
  if (canvas) {
    const ctx = canvas.getContext('2d');
    let petals: Petal[] = [];

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // The main cherry blossom petal class
    class Petal {
      x: number;
      y: number;
      size: number;
      speedX: number;
      speedY: number;
      angle: number;
      spin: number;
      sway: number;
      color: string;
      depth: number;

      constructor() {
        this.depth = Math.random(); // Depth determines size, speed, and opacity
        // Adjusted size to 4x the original base size
        this.size = ((this.depth * 8) + 5) * 4; 
        this.x = Math.random() * canvas.width * 1.5 - (canvas.width * 0.25);
        this.y = Math.random() * -canvas.height;
        this.speedY = (this.depth * 0.8) + 0.7;
        this.speedX = (this.depth * 0.6) + 0.5;
        this.angle = Math.random() * Math.PI * 2;
        this.spin = Math.random() < 0.5 ? -1 : 1;
        this.sway = Math.random() * 0.8;
        this.color = `rgba(255, 192, 203, ${this.depth * 0.5 + 0.5})`;
      }

      update() {
        this.y += this.speedY;
        this.x -= this.speedX;
        this.x += Math.sin(this.angle) * this.sway;
        this.angle += 0.03 * this.spin;

        if (this.y > canvas.height + this.size || this.x < -this.size) {
          this.x = Math.random() * canvas.width * 1.5 - (canvas.width * 0.25);
          this.y = -20;
        }
      }

      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle);
        
        ctx.shadowColor = 'rgba(255, 255, 255, 0.7)';
        ctx.shadowBlur = 10;

        ctx.beginPath();
        // Use bezier curves to draw a more realistic petal shape with a notch
        const s = this.size / 2; // scale factor
        ctx.moveTo(0, 0);
        ctx.bezierCurveTo(s, -s, s * 2, -s, s * 2, 0);
        ctx.bezierCurveTo(s * 2, s, s, s, 0, s * 2); // Bottom point
        ctx.bezierCurveTo(-s, s, -s * 2, s, -s * 2, 0);
        ctx.bezierCurveTo(-s * 2, -s, -s, -s, 0, 0);

        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.closePath();
        
        ctx.restore();
      }
    }

    function init() {
      // Adjusted number of particles since they are larger and there are no dust particles
      const numberOfPetals = Math.floor(window.innerWidth / 50);
      for (let i = 0; i < numberOfPetals; i++) {
        petals.push(new Petal());
      }
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < petals.length; i++) {
        petals[i].update();
        petals[i].draw();
      }
      requestAnimationFrame(animate);
    }

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      petals = [];
      init();
    });

    init();
    animate();
  }
</script>
