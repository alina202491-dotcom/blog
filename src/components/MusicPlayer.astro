---
// src/components/MusicPlayer.astro
//
// 使用说明:
// 1. 将此文件保存到你的 Astro 项目的 `src/components/` 目录下。
// 2. 在你的主布局文件 (例如 `src/layouts/Layout.astro`) 中导入并使用它。
//
// 自定义配置:
// 你可以修改下面的 `props` 来更换不同的音乐平台和歌单。
// - server: 音乐平台。可选值: "netease", "tencent", "kugou", "kuwo", "bilibili", "xiami"
// - type: 类型。可选值: "song", "playlist", "album", "search", "artist"
// - id: 对应类型的 ID。例如，网易云歌单的 ID。

export interface Props {
  server?: 'netease' | 'tencent' | 'kugou' | 'kuwo' | 'bilibili' | 'xiami';
  type?: 'song' | 'playlist' | 'album' | 'search' | 'artist';
  id?: string;
}

const {
  server = 'netease', // 默认使用网易云音乐
  type = 'playlist',   // 默认类型为歌单
  id = '3778678',       // 默认使用网易云音乐热歌榜作为示例
} = Astro.props;

// 【修复】我们换用一个更稳定、公开的 Meting API 服务
const reliableApi = `https://api.i-meto.com/meting/api?server=${server}&type=${type}&id=${id}&r=${Math.random()}`;
---

<!-- 
  我们使用新的 `api` 属性指向更可靠的服务地址。
-->
<meting-js
  api={reliableApi}
  server={server}
  type={type}
  id={id}
  fixed="true"
  theme="#2980b9"
  order="random"
  lrc-type="1"
  volume="0.7"
  mini="true"
  preload="auto"
>
</meting-js>

<!-- 
  加载 MetingJS 的脚本文件。
-->
<script is:inline src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

<!--
  【修复】使用更强的CSS样式来强制显示播放器，以防被主题的其他样式覆盖。
  如果播放器正常显示，你可以删除这个 <style> 标签。
-->
<style is:global>
  .aplayer.aplayer-fixed {
    position: fixed !important;
    left: 15px !important;
    bottom: 15px !important;
    width: 280px !important; /* 确保有宽度 */
    height: 66px !important; /* 确保有高度 */
    z-index: 2147483647 !important; /* 使用最高的 z-index，确保在最顶层 */
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    border: 2px solid lime !important; /* 添加一个亮绿色边框，方便一眼看到 */
  }
</style>
